{
  "version": 3,
  "sources": ["../../../../node_modules/@aws-amplify/backend-function/src/lambda-shims/cjs_shim.ts", "../../../../amplify/functions/alpacaNews/handler.ts"],
  "sourcesContent": ["import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport url from 'node:url';\nglobal.require = createRequire(import.meta.url);\nglobal.__filename = url.fileURLToPath(import.meta.url);\nglobal.__dirname = path.dirname(__filename);\n", "export async function handler(event: any) {\r\n  try {\r\n    const params = event.queryStringParameters || {};\r\n    const ticker = params.ticker?.toUpperCase() || \"\";\r\n    const limit = params.limit || \"20\";\r\n\r\n    const url = `https://data.alpaca.markets/v1beta1/news?sort=desc&limit=${limit}${ticker ? `&symbols=${ticker}` : \"\"}`;\r\n\r\n    console.log(\"process.env.ALPACA_API_KEY :\", process.env.ALPACA_API_KEY);\r\n    console.log(\r\n      \"process.env.ALPACA_API_SECRET :\",\r\n      process.env.ALPACA_API_SECRET\r\n    );\r\n    console.log(\"process.env.secrets raw:\", process.env.secrets);\r\n\r\n    const secrets = process.env.secrets ? JSON.parse(process.env.secrets) : {};\r\n    console.log(\"Parsed secrets keys:\", Object.keys(secrets));\r\n\r\n    const apiKey = (process.env.ALPACA_API_KEY || \"\")\r\n      .trim()\r\n      .replace(/\\r?\\n|\\r/g, \"\");\r\n    const apiSecret = (process.env.ALPACA_API_SECRET || \"\")\r\n      .trim()\r\n      .replace(/\\r?\\n|\\r/g, \"\");\r\n\r\n    console.log(\"Using API Key :\", apiKey);\r\n    console.log(\"Using API Secret :\", apiSecret);\r\n\r\n    const res = await fetch(url, {\r\n      headers: {\r\n        accept: \"application/json\",\r\n        \"APCA-API-KEY-ID\": apiKey,\r\n        \"APCA-API-SECRET-KEY\": apiSecret,\r\n      },\r\n    });\r\n\r\n    // const res = await fetch(url, {\r\n    //   headers: {\r\n    //     accept: \"application/json\",\r\n    //     \"APCA-API-KEY-ID\": process.env.ALPACA_API_KEY!,\r\n    //     \"APCA-API-SECRET-KEY\": process.env.ALPACA_API_SECRET!,\r\n    //   },\r\n    // });\r\n\r\n    const text = await res.text(); // safer than res.json()\r\n    console.log(\"Raw response:\", text);\r\n\r\n    if (!res.ok) {\r\n      return {\r\n        statusCode: res.status,\r\n        body: JSON.stringify({ error: \"Failed to fetch\", details: text }),\r\n      };\r\n    }\r\n\r\n    const raw = JSON.parse(text);\r\n    const parsed = Array.isArray(raw?.news)\r\n      ? raw.news.map((item: any) => ({\r\n          id: item.id,\r\n          headline: item.headline,\r\n          summary: item.summary,\r\n          author: item.author,\r\n          source: item.source,\r\n          created_at: item.created_at,\r\n          updated_at: item.updated_at,\r\n          url: item.url,\r\n          symbols: item.symbols,\r\n          images: item.images,\r\n        }))\r\n      : [];\r\n\r\n    return { statusCode: 200, body: JSON.stringify(parsed) };\r\n  } catch (err: any) {\r\n    return { statusCode: 500, body: JSON.stringify({ error: err.message }) };\r\n  }\r\n}\r\n"],
  "mappings": ";AAAA,OAAS,iBAAAA,MAAqB,cAC9B,OAAOC,MAAU,YACjB,OAAOC,MAAS,WAChB,OAAO,QAAUF,EAAc,YAAY,GAAG,EAC9C,OAAO,WAAaE,EAAI,cAAc,YAAY,GAAG,EACrD,OAAO,UAAYD,EAAK,QAAQ,UAAU,ECL1C,eAAsBE,EAAQC,EAAY,CACxC,GAAI,CACF,IAAMC,EAASD,EAAM,uBAAyB,CAAC,EACzCE,EAASD,EAAO,QAAQ,YAAY,GAAK,GAGzCE,EAAM,4DAFEF,EAAO,OAAS,IAE+C,GAAGC,EAAS,YAAYA,CAAM,GAAK,EAAE,GAElH,QAAQ,IAAI,+BAAgC,QAAQ,IAAI,cAAc,EACtE,QAAQ,IACN,kCACA,QAAQ,IAAI,iBACd,EACA,QAAQ,IAAI,2BAA4B,QAAQ,IAAI,OAAO,EAE3D,IAAME,EAAU,QAAQ,IAAI,QAAU,KAAK,MAAM,QAAQ,IAAI,OAAO,EAAI,CAAC,EACzE,QAAQ,IAAI,uBAAwB,OAAO,KAAKA,CAAO,CAAC,EAExD,IAAMC,GAAU,QAAQ,IAAI,gBAAkB,IAC3C,KAAK,EACL,QAAQ,YAAa,EAAE,EACpBC,GAAa,QAAQ,IAAI,mBAAqB,IACjD,KAAK,EACL,QAAQ,YAAa,EAAE,EAE1B,QAAQ,IAAI,kBAAmBD,CAAM,EACrC,QAAQ,IAAI,qBAAsBC,CAAS,EAE3C,IAAMC,EAAM,MAAM,MAAMJ,EAAK,CAC3B,QAAS,CACP,OAAQ,mBACR,kBAAmBE,EACnB,sBAAuBC,CACzB,CACF,CAAC,EAUKE,EAAO,MAAMD,EAAI,KAAK,EAG5B,GAFA,QAAQ,IAAI,gBAAiBC,CAAI,EAE7B,CAACD,EAAI,GACP,MAAO,CACL,WAAYA,EAAI,OAChB,KAAM,KAAK,UAAU,CAAE,MAAO,kBAAmB,QAASC,CAAK,CAAC,CAClE,EAGF,IAAMC,EAAM,KAAK,MAAMD,CAAI,EACrBE,EAAS,MAAM,QAAQD,GAAK,IAAI,EAClCA,EAAI,KAAK,IAAKE,IAAe,CAC3B,GAAIA,EAAK,GACT,SAAUA,EAAK,SACf,QAASA,EAAK,QACd,OAAQA,EAAK,OACb,OAAQA,EAAK,OACb,WAAYA,EAAK,WACjB,WAAYA,EAAK,WACjB,IAAKA,EAAK,IACV,QAASA,EAAK,QACd,OAAQA,EAAK,MACf,EAAE,EACF,CAAC,EAEL,MAAO,CAAE,WAAY,IAAK,KAAM,KAAK,UAAUD,CAAM,CAAE,CACzD,OAASE,EAAU,CACjB,MAAO,CAAE,WAAY,IAAK,KAAM,KAAK,UAAU,CAAE,MAAOA,EAAI,OAAQ,CAAC,CAAE,CACzE,CACF",
  "names": ["createRequire", "path", "url", "handler", "event", "params", "ticker", "url", "secrets", "apiKey", "apiSecret", "res", "text", "raw", "parsed", "item", "err"]
}
